function cov_1ko31etpal(){var path="C:\\Users\\Rokon\\source\\repos\\SWENG894-Capstone-Project\\controllers\\poll.js";var hash="73a6489b7b466e9d9ea7ec38c2f82f4a96fd5991";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"C:\\Users\\Rokon\\source\\repos\\SWENG894-Capstone-Project\\controllers\\poll.js",statementMap:{"0":{start:{line:1,column:11},end:{line:1,column:41}},"1":{start:{line:2,column:15},end:{line:2,column:32}},"2":{start:{line:4,column:25},end:{line:6,column:1}},"3":{start:{line:5,column:4},end:{line:5,column:63}},"4":{start:{line:8,column:13},end:{line:50,column:1}},"5":{start:{line:9,column:89},end:{line:9,column:97}},"6":{start:{line:11,column:4},end:{line:13,column:5}},"7":{start:{line:12,column:8},end:{line:12,column:120}},"8":{start:{line:15,column:15},end:{line:15,column:19}},"9":{start:{line:16,column:4},end:{line:18,column:5}},"10":{start:{line:17,column:8},end:{line:17,column:34}},"11":{start:{line:20,column:4},end:{line:49,column:5}},"12":{start:{line:22,column:25},end:{line:30,column:10}},"13":{start:{line:32,column:23},end:{line:32,column:38}},"14":{start:{line:35,column:33},end:{line:40,column:10}},"15":{start:{line:36,column:12},end:{line:39,column:15}},"16":{start:{line:43,column:8},end:{line:43,column:44}},"17":{start:{line:45,column:8},end:{line:45,column:149}},"18":{start:{line:47,column:8},end:{line:47,column:60}},"19":{start:{line:48,column:8},end:{line:48,column:89}},"20":{start:{line:52,column:0},end:{line:52,column:22}}},fnMap:{"0":{name:"(anonymous_0)",decl:{start:{line:4,column:25},end:{line:4,column:26}},loc:{start:{line:4,column:31},end:{line:6,column:1}},line:4},"1":{name:"(anonymous_1)",decl:{start:{line:8,column:13},end:{line:8,column:14}},loc:{start:{line:8,column:33},end:{line:50,column:1}},line:8},"2":{name:"(anonymous_2)",decl:{start:{line:35,column:48},end:{line:35,column:49}},loc:{start:{line:35,column:61},end:{line:40,column:9}},line:35}},branchMap:{"0":{loc:{start:{line:11,column:4},end:{line:13,column:5}},type:"if",locations:[{start:{line:11,column:4},end:{line:13,column:5}},{start:{line:undefined,column:undefined},end:{line:undefined,column:undefined}}],line:11},"1":{loc:{start:{line:11,column:8},end:{line:11,column:93}},type:"binary-expr",locations:[{start:{line:11,column:8},end:{line:11,column:14}},{start:{line:11,column:18},end:{line:11,column:30}},{start:{line:11,column:34},end:{line:11,column:43}},{start:{line:11,column:47},end:{line:11,column:51}},{start:{line:11,column:55},end:{line:11,column:66}},{start:{line:11,column:70},end:{line:11,column:93}}],line:11},"2":{loc:{start:{line:16,column:4},end:{line:18,column:5}},type:"if",locations:[{start:{line:16,column:4},end:{line:18,column:5}},{start:{line:undefined,column:undefined},end:{line:undefined,column:undefined}}],line:16},"3":{loc:{start:{line:28,column:30},end:{line:28,column:53}},type:"cond-expr",locations:[{start:{line:28,column:48},end:{line:28,column:49}},{start:{line:28,column:52},end:{line:28,column:53}}],line:28},"4":{loc:{start:{line:45,column:92},end:{line:45,column:125}},type:"cond-expr",locations:[{start:{line:45,column:99},end:{line:45,column:120}},{start:{line:45,column:123},end:{line:45,column:125}}],line:45}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0},f:{"0":0,"1":0,"2":0},b:{"0":[0,0],"1":[0,0,0,0,0,0],"2":[0,0],"3":[0,0],"4":[0,0]},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"73a6489b7b466e9d9ea7ec38c2f82f4a96fd5991"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];{// @ts-ignore
cov_1ko31etpal=function(){return actualCoverage;};}return actualCoverage;}cov_1ko31etpal();const db=(cov_1ko31etpal().s[0]++,require("../routes/db-config"));const crypto=(cov_1ko31etpal().s[1]++,require('crypto'));cov_1ko31etpal().s[2]++;const generatePollCode=()=>{cov_1ko31etpal().f[0]++;cov_1ko31etpal().s[3]++;return crypto.randomBytes(3).toString('hex').toUpperCase();};cov_1ko31etpal().s[4]++;const poll=async(req,res)=>{cov_1ko31etpal().f[1]++;const{title,admin_email,deadline,age,polltype,enableAnonymous,candidates}=(cov_1ko31etpal().s[5]++,req.body);cov_1ko31etpal().s[6]++;if((cov_1ko31etpal().b[1][0]++,!title)||(cov_1ko31etpal().b[1][1]++,!admin_email)||(cov_1ko31etpal().b[1][2]++,!deadline)||(cov_1ko31etpal().b[1][3]++,!age)||(cov_1ko31etpal().b[1][4]++,!candidates)||(cov_1ko31etpal().b[1][5]++,candidates.length===0)){cov_1ko31etpal().b[0][0]++;cov_1ko31etpal().s[7]++;return res.json({status:"error",error:"Please provide all required fields. Ensure candidates are added!"});}else{cov_1ko31etpal().b[0][1]++;}let code=(cov_1ko31etpal().s[8]++,null);cov_1ko31etpal().s[9]++;if(polltype==='Private'){cov_1ko31etpal().b[2][0]++;cov_1ko31etpal().s[10]++;code=generatePollCode();}else{cov_1ko31etpal().b[2][1]++;}cov_1ko31etpal().s[11]++;try{// Insert the poll details into the polls table
const[result]=(cov_1ko31etpal().s[12]++,await db.query('INSERT INTO polls SET ?',{title:title,admin_email:admin_email,deadline:deadline,age_requirement:age,poll_type:polltype,enable_anonymous:enableAnonymous?(cov_1ko31etpal().b[3][0]++,1):(cov_1ko31etpal().b[3][1]++,0),code:code}));const pollId=(cov_1ko31etpal().s[13]++,result.insertId);// Insert each candidate into the candidates table
const candidateInserts=(cov_1ko31etpal().s[14]++,candidates.map(candidate=>{cov_1ko31etpal().f[2]++;cov_1ko31etpal().s[15]++;return db.query('INSERT INTO candidates SET ?',{poll_id:pollId,name:candidate});}));// Wait for all candidate inserts to complete
cov_1ko31etpal().s[16]++;await Promise.all(candidateInserts);cov_1ko31etpal().s[17]++;return res.json({status:"success",success:`Poll has been created successfully!${code?(cov_1ko31etpal().b[4][0]++,' Poll Code: '+code):(cov_1ko31etpal().b[4][1]++,'')}`,redirectUrl:"/"});}catch(error){cov_1ko31etpal().s[18]++;console.error("Error during poll creation:",error);cov_1ko31etpal().s[19]++;return res.status(500).json({status:"error",error:"Internal server error"});}};cov_1ko31etpal().s[20]++;module.exports=poll;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJjb3ZfMWtvMzFldHBhbCIsImFjdHVhbENvdmVyYWdlIiwiZGIiLCJzIiwicmVxdWlyZSIsImNyeXB0byIsImdlbmVyYXRlUG9sbENvZGUiLCJmIiwicmFuZG9tQnl0ZXMiLCJ0b1N0cmluZyIsInRvVXBwZXJDYXNlIiwicG9sbCIsInJlcSIsInJlcyIsInRpdGxlIiwiYWRtaW5fZW1haWwiLCJkZWFkbGluZSIsImFnZSIsInBvbGx0eXBlIiwiZW5hYmxlQW5vbnltb3VzIiwiY2FuZGlkYXRlcyIsImJvZHkiLCJiIiwibGVuZ3RoIiwianNvbiIsInN0YXR1cyIsImVycm9yIiwiY29kZSIsInJlc3VsdCIsInF1ZXJ5IiwiYWdlX3JlcXVpcmVtZW50IiwicG9sbF90eXBlIiwiZW5hYmxlX2Fub255bW91cyIsInBvbGxJZCIsImluc2VydElkIiwiY2FuZGlkYXRlSW5zZXJ0cyIsIm1hcCIsImNhbmRpZGF0ZSIsInBvbGxfaWQiLCJuYW1lIiwiUHJvbWlzZSIsImFsbCIsInN1Y2Nlc3MiLCJyZWRpcmVjdFVybCIsImNvbnNvbGUiLCJtb2R1bGUiLCJleHBvcnRzIl0sInNvdXJjZXMiOlsicG9sbC5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCBkYiA9IHJlcXVpcmUoXCIuLi9yb3V0ZXMvZGItY29uZmlnXCIpO1xyXG5jb25zdCBjcnlwdG8gPSByZXF1aXJlKCdjcnlwdG8nKTtcclxuXHJcbmNvbnN0IGdlbmVyYXRlUG9sbENvZGUgPSAoKSA9PiB7XHJcbiAgICByZXR1cm4gY3J5cHRvLnJhbmRvbUJ5dGVzKDMpLnRvU3RyaW5nKCdoZXgnKS50b1VwcGVyQ2FzZSgpO1xyXG59O1xyXG5cclxuY29uc3QgcG9sbCA9IGFzeW5jIChyZXEsIHJlcykgPT4ge1xyXG4gICAgY29uc3QgeyB0aXRsZSwgYWRtaW5fZW1haWwsIGRlYWRsaW5lLCBhZ2UsIHBvbGx0eXBlLCBlbmFibGVBbm9ueW1vdXMsIGNhbmRpZGF0ZXMgfSA9IHJlcS5ib2R5O1xyXG5cclxuICAgIGlmICghdGl0bGUgfHwgIWFkbWluX2VtYWlsIHx8ICFkZWFkbGluZSB8fCAhYWdlIHx8ICFjYW5kaWRhdGVzIHx8IGNhbmRpZGF0ZXMubGVuZ3RoID09PSAwKSB7XHJcbiAgICAgICAgcmV0dXJuIHJlcy5qc29uKHsgc3RhdHVzOiBcImVycm9yXCIsIGVycm9yOiBcIlBsZWFzZSBwcm92aWRlIGFsbCByZXF1aXJlZCBmaWVsZHMuIEVuc3VyZSBjYW5kaWRhdGVzIGFyZSBhZGRlZCFcIiB9KTtcclxuICAgIH1cclxuXHJcbiAgICBsZXQgY29kZSA9IG51bGw7XHJcbiAgICBpZiAocG9sbHR5cGUgPT09ICdQcml2YXRlJykge1xyXG4gICAgICAgIGNvZGUgPSBnZW5lcmF0ZVBvbGxDb2RlKCk7XHJcbiAgICB9XHJcblxyXG4gICAgdHJ5IHtcclxuICAgICAgICAvLyBJbnNlcnQgdGhlIHBvbGwgZGV0YWlscyBpbnRvIHRoZSBwb2xscyB0YWJsZVxyXG4gICAgICAgIGNvbnN0IFtyZXN1bHRdID0gYXdhaXQgZGIucXVlcnkoJ0lOU0VSVCBJTlRPIHBvbGxzIFNFVCA/Jywge1xyXG4gICAgICAgICAgICB0aXRsZTogdGl0bGUsXHJcbiAgICAgICAgICAgIGFkbWluX2VtYWlsOiBhZG1pbl9lbWFpbCxcclxuICAgICAgICAgICAgZGVhZGxpbmU6IGRlYWRsaW5lLFxyXG4gICAgICAgICAgICBhZ2VfcmVxdWlyZW1lbnQ6IGFnZSxcclxuICAgICAgICAgICAgcG9sbF90eXBlOiBwb2xsdHlwZSxcclxuICAgICAgICAgICAgZW5hYmxlX2Fub255bW91czogZW5hYmxlQW5vbnltb3VzID8gMSA6IDAsXHJcbiAgICAgICAgICAgIGNvZGU6IGNvZGVcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgY29uc3QgcG9sbElkID0gcmVzdWx0Lmluc2VydElkO1xyXG5cclxuICAgICAgICAvLyBJbnNlcnQgZWFjaCBjYW5kaWRhdGUgaW50byB0aGUgY2FuZGlkYXRlcyB0YWJsZVxyXG4gICAgICAgIGNvbnN0IGNhbmRpZGF0ZUluc2VydHMgPSBjYW5kaWRhdGVzLm1hcChjYW5kaWRhdGUgPT4ge1xyXG4gICAgICAgICAgICByZXR1cm4gZGIucXVlcnkoJ0lOU0VSVCBJTlRPIGNhbmRpZGF0ZXMgU0VUID8nLCB7XHJcbiAgICAgICAgICAgICAgICBwb2xsX2lkOiBwb2xsSWQsXHJcbiAgICAgICAgICAgICAgICBuYW1lOiBjYW5kaWRhdGVcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIC8vIFdhaXQgZm9yIGFsbCBjYW5kaWRhdGUgaW5zZXJ0cyB0byBjb21wbGV0ZVxyXG4gICAgICAgIGF3YWl0IFByb21pc2UuYWxsKGNhbmRpZGF0ZUluc2VydHMpO1xyXG5cclxuICAgICAgICByZXR1cm4gcmVzLmpzb24oeyBzdGF0dXM6IFwic3VjY2Vzc1wiLCBzdWNjZXNzOiBgUG9sbCBoYXMgYmVlbiBjcmVhdGVkIHN1Y2Nlc3NmdWxseSEke2NvZGUgPyAnIFBvbGwgQ29kZTogJyArIGNvZGUgOiAnJ31gLCByZWRpcmVjdFVybDogXCIvXCIgfSk7XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBkdXJpbmcgcG9sbCBjcmVhdGlvbjpcIiwgZXJyb3IpO1xyXG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDUwMCkuanNvbih7IHN0YXR1czogXCJlcnJvclwiLCBlcnJvcjogXCJJbnRlcm5hbCBzZXJ2ZXIgZXJyb3JcIiB9KTtcclxuICAgIH1cclxufTtcclxuXHJcbm1vZHVsZS5leHBvcnRzID0gcG9sbDtcclxuIl0sIm1hcHBpbmdzIjoic29IQWVZO0FBQUFBLGNBQUEsU0FBQUEsQ0FBQSxTQUFBQyxjQUFBLFdBQUFBLGNBQUEsRUFBQUQsY0FBQSxHQWZaLEtBQU0sQ0FBQUUsRUFBRSxFQUFBRixjQUFBLEdBQUFHLENBQUEsTUFBR0MsT0FBTyxDQUFDLHFCQUFxQixDQUFDLEVBQ3pDLEtBQU0sQ0FBQUMsTUFBTSxFQUFBTCxjQUFB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