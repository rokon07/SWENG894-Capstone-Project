function cov_24xxvzen3i(){var path="C:\\Users\\Rokon\\source\\repos\\SWENG894-Capstone-Project\\controllers\\register.js";var hash="442aebfe716d65f4e55a70474e29a53b75d43ebf";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"C:\\Users\\Rokon\\source\\repos\\SWENG894-Capstone-Project\\controllers\\register.js",statementMap:{"0":{start:{line:1,column:11},end:{line:1,column:41}},"1":{start:{line:2,column:15},end:{line:2,column:34}},"2":{start:{line:4,column:17},end:{line:48,column:1}},"3":{start:{line:5,column:89},end:{line:5,column:97}},"4":{start:{line:8,column:4},end:{line:10,column:5}},"5":{start:{line:9,column:8},end:{line:9,column:93}},"6":{start:{line:12,column:4},end:{line:14,column:5}},"7":{start:{line:13,column:8},end:{line:13,column:95}},"8":{start:{line:17,column:24},end:{line:17,column:65}},"9":{start:{line:18,column:22},end:{line:18,column:61}},"10":{start:{line:20,column:4},end:{line:47,column:5}},"11":{start:{line:22,column:31},end:{line:22,column:101}},"12":{start:{line:23,column:8},end:{line:25,column:9}},"13":{start:{line:24,column:12},end:{line:24,column:94}},"14":{start:{line:28,column:25},end:{line:28,column:56}},"15":{start:{line:31,column:8},end:{line:41,column:11}},"16":{start:{line:43,column:8},end:{line:43,column:132}},"17":{start:{line:45,column:8},end:{line:45,column:64}},"18":{start:{line:46,column:8},end:{line:46,column:89}},"19":{start:{line:50,column:0},end:{line:50,column:26}}},fnMap:{"0":{name:"(anonymous_0)",decl:{start:{line:4,column:17},end:{line:4,column:18}},loc:{start:{line:4,column:37},end:{line:48,column:1}},line:4}},branchMap:{"0":{loc:{start:{line:8,column:4},end:{line:10,column:5}},type:"if",locations:[{start:{line:8,column:4},end:{line:10,column:5}},{start:{line:8,column:4},end:{line:10,column:5}}],line:8},"1":{loc:{start:{line:8,column:8},end:{line:8,column:28}},type:"binary-expr",locations:[{start:{line:8,column:8},end:{line:8,column:14}},{start:{line:8,column:18},end:{line:8,column:28}}],line:8},"2":{loc:{start:{line:12,column:4},end:{line:14,column:5}},type:"if",locations:[{start:{line:12,column:4},end:{line:14,column:5}},{start:{line:12,column:4},end:{line:14,column:5}}],line:12},"3":{loc:{start:{line:17,column:24},end:{line:17,column:65}},type:"cond-expr",locations:[{start:{line:17,column:43},end:{line:17,column:56}},{start:{line:17,column:59},end:{line:17,column:65}}],line:17},"4":{loc:{start:{line:18,column:22},end:{line:18,column:61}},type:"cond-expr",locations:[{start:{line:18,column:41},end:{line:18,column:54}},{start:{line:18,column:57},end:{line:18,column:61}}],line:18},"5":{loc:{start:{line:23,column:8},end:{line:25,column:9}},type:"if",locations:[{start:{line:23,column:8},end:{line:25,column:9}},{start:{line:23,column:8},end:{line:25,column:9}}],line:23}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0},f:{"0":0},b:{"0":[0,0],"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0]},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"442aebfe716d65f4e55a70474e29a53b75d43ebf"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];{// @ts-ignore
cov_24xxvzen3i=function(){return actualCoverage;};}return actualCoverage;}cov_24xxvzen3i();const db=(cov_24xxvzen3i().s[0]++,require("../routes/db-config"));const bcrypt=(cov_24xxvzen3i().s[1]++,require("bcryptjs"));cov_24xxvzen3i().s[2]++;const register=async(req,res)=>{cov_24xxvzen3i().f[0]++;const{email,password:Npassword,fname,lname,phone,dob,role,gender,race}=(cov_24xxvzen3i().s[3]++,req.body);// Validate inputs
cov_24xxvzen3i().s[4]++;if((cov_24xxvzen3i().b[1][0]++,!email)||(cov_24xxvzen3i().b[1][1]++,!Npassword)){cov_24xxvzen3i().b[0][0]++;cov_24xxvzen3i().s[5]++;return res.json({status:"error",error:"Please enter your email and password."});}else{cov_24xxvzen3i().b[0][1]++;}cov_24xxvzen3i().s[6]++;if(!/^\d{10}$/.test(phone)){cov_24xxvzen3i().b[2][0]++;cov_24xxvzen3i().s[7]++;return res.json({status:"error",error:"Phone number must be exactly 10 digits."});}else{cov_24xxvzen3i().b[2][1]++;}// Set default values for gender and race if role is admin
const finalGender=(cov_24xxvzen3i().s[8]++,role==='admin'?(cov_24xxvzen3i().b[3][0]++,'unspecified'):(cov_24xxvzen3i().b[3][1]++,gender));const finalRace=(cov_24xxvzen3i().s[9]++,role==='admin'?(cov_24xxvzen3i().b[4][0]++,'unspecified'):(cov_24xxvzen3i().b[4][1]++,race));cov_24xxvzen3i().s[10]++;try{// Check if email already exists
const[existingUser]=(cov_24xxvzen3i().s[11]++,await db.query('SELECT email FROM user_data WHERE email = ?',[email]));cov_24xxvzen3i().s[12]++;if(existingUser.length>0){cov_24xxvzen3i().b[5][0]++;cov_24xxvzen3i().s[13]++;return res.json({status:"error",error:"Email has already been registered!"});}else{cov_24xxvzen3i().b[5][1]++;}// Hash the password
const password=(cov_24xxvzen3i().s[14]++,await bcrypt.hash(Npassword,8));// Insert the new user into the database
cov_24xxvzen3i().s[15]++;await db.query('INSERT INTO user_data SET ?',{email:email,password:password,fname:fname,lname:lname,phone:phone,dob:dob,role:role,gender:finalGender,race:finalRace});cov_24xxvzen3i().s[16]++;return res.json({status:"success",success:"User has been registered; you can try logging in!",redirectUrl:"/login"});}catch(error){cov_24xxvzen3i().s[17]++;console.error("Error during user registration:",error);cov_24xxvzen3i().s[18]++;return res.status(500).json({status:"error",error:"Internal server error"});}};cov_24xxvzen3i().s[19]++;module.exports=register;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJjb3ZfMjR4eHZ6ZW4zaSIsImFjdHVhbENvdmVyYWdlIiwiZGIiLCJzIiwicmVxdWlyZSIsImJjcnlwdCIsInJlZ2lzdGVyIiwicmVxIiwicmVzIiwiZiIsImVtYWlsIiwicGFzc3dvcmQiLCJOcGFzc3dvcmQiLCJmbmFtZSIsImxuYW1lIiwicGhvbmUiLCJkb2IiLCJyb2xlIiwiZ2VuZGVyIiwicmFjZSIsImJvZHkiLCJiIiwianNvbiIsInN0YXR1cyIsImVycm9yIiwidGVzdCIsImZpbmFsR2VuZGVyIiwiZmluYWxSYWNlIiwiZXhpc3RpbmdVc2VyIiwicXVlcnkiLCJsZW5ndGgiLCJoYXNoIiwic3VjY2VzcyIsInJlZGlyZWN0VXJsIiwiY29uc29sZSIsIm1vZHVsZSIsImV4cG9ydHMiXSwic291cmNlcyI6WyJyZWdpc3Rlci5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCBkYiA9IHJlcXVpcmUoXCIuLi9yb3V0ZXMvZGItY29uZmlnXCIpO1xyXG5jb25zdCBiY3J5cHQgPSByZXF1aXJlKFwiYmNyeXB0anNcIik7XHJcblxyXG5jb25zdCByZWdpc3RlciA9IGFzeW5jIChyZXEsIHJlcykgPT4ge1xyXG4gICAgY29uc3QgeyBlbWFpbCwgcGFzc3dvcmQ6IE5wYXNzd29yZCwgZm5hbWUsIGxuYW1lLCBwaG9uZSwgZG9iLCByb2xlLCBnZW5kZXIsIHJhY2UgfSA9IHJlcS5ib2R5O1xyXG5cclxuICAgIC8vIFZhbGlkYXRlIGlucHV0c1xyXG4gICAgaWYgKCFlbWFpbCB8fCAhTnBhc3N3b3JkKSB7XHJcbiAgICAgICAgcmV0dXJuIHJlcy5qc29uKHsgc3RhdHVzOiBcImVycm9yXCIsIGVycm9yOiBcIlBsZWFzZSBlbnRlciB5b3VyIGVtYWlsIGFuZCBwYXNzd29yZC5cIiB9KTtcclxuICAgIH1cclxuXHJcbiAgICBpZiAoIS9eXFxkezEwfSQvLnRlc3QocGhvbmUpKSB7XHJcbiAgICAgICAgcmV0dXJuIHJlcy5qc29uKHsgc3RhdHVzOiBcImVycm9yXCIsIGVycm9yOiBcIlBob25lIG51bWJlciBtdXN0IGJlIGV4YWN0bHkgMTAgZGlnaXRzLlwiIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIFNldCBkZWZhdWx0IHZhbHVlcyBmb3IgZ2VuZGVyIGFuZCByYWNlIGlmIHJvbGUgaXMgYWRtaW5cclxuICAgIGNvbnN0IGZpbmFsR2VuZGVyID0gcm9sZSA9PT0gJ2FkbWluJyA/ICd1bnNwZWNpZmllZCcgOiBnZW5kZXI7XHJcbiAgICBjb25zdCBmaW5hbFJhY2UgPSByb2xlID09PSAnYWRtaW4nID8gJ3Vuc3BlY2lmaWVkJyA6IHJhY2U7XHJcblxyXG4gICAgdHJ5IHtcclxuICAgICAgICAvLyBDaGVjayBpZiBlbWFpbCBhbHJlYWR5IGV4aXN0c1xyXG4gICAgICAgIGNvbnN0IFtleGlzdGluZ1VzZXJdID0gYXdhaXQgZGIucXVlcnkoJ1NFTEVDVCBlbWFpbCBGUk9NIHVzZXJfZGF0YSBXSEVSRSBlbWFpbCA9ID8nLCBbZW1haWxdKTtcclxuICAgICAgICBpZiAoZXhpc3RpbmdVc2VyLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgcmV0dXJuIHJlcy5qc29uKHsgc3RhdHVzOiBcImVycm9yXCIsIGVycm9yOiBcIkVtYWlsIGhhcyBhbHJlYWR5IGJlZW4gcmVnaXN0ZXJlZCFcIiB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIEhhc2ggdGhlIHBhc3N3b3JkXHJcbiAgICAgICAgY29uc3QgcGFzc3dvcmQgPSBhd2FpdCBiY3J5cHQuaGFzaChOcGFzc3dvcmQsIDgpO1xyXG5cclxuICAgICAgICAvLyBJbnNlcnQgdGhlIG5ldyB1c2VyIGludG8gdGhlIGRhdGFiYXNlXHJcbiAgICAgICAgYXdhaXQgZGIucXVlcnkoJ0lOU0VSVCBJTlRPIHVzZXJfZGF0YSBTRVQgPycsIHtcclxuICAgICAgICAgICAgZW1haWw6IGVtYWlsLFxyXG4gICAgICAgICAgICBwYXNzd29yZDogcGFzc3dvcmQsXHJcbiAgICAgICAgICAgIGZuYW1lOiBmbmFtZSxcclxuICAgICAgICAgICAgbG5hbWU6IGxuYW1lLFxyXG4gICAgICAgICAgICBwaG9uZTogcGhvbmUsXHJcbiAgICAgICAgICAgIGRvYjogZG9iLFxyXG4gICAgICAgICAgICByb2xlOiByb2xlLFxyXG4gICAgICAgICAgICBnZW5kZXI6IGZpbmFsR2VuZGVyLFxyXG4gICAgICAgICAgICByYWNlOiBmaW5hbFJhY2VcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgcmV0dXJuIHJlcy5qc29uKHsgc3RhdHVzOiBcInN1Y2Nlc3NcIiwgc3VjY2VzczogXCJVc2VyIGhhcyBiZWVuIHJlZ2lzdGVyZWQ7IHlvdSBjYW4gdHJ5IGxvZ2dpbmcgaW4hXCIsIHJlZGlyZWN0VXJsOiBcIi9sb2dpblwiIH0pO1xyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgZHVyaW5nIHVzZXIgcmVnaXN0cmF0aW9uOlwiLCBlcnJvcik7XHJcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNTAwKS5qc29uKHsgc3RhdHVzOiBcImVycm9yXCIsIGVycm9yOiBcIkludGVybmFsIHNlcnZlciBlcnJvclwiIH0pO1xyXG4gICAgfVxyXG59O1xyXG5cclxubW9kdWxlLmV4cG9ydHMgPSByZWdpc3RlcjtcclxuIl0sIm1hcHBpbmdzIjoidXNHQWVZO0FBQUFBLGNBQUEsU0FBQUEsQ0FBQSxTQUFBQyxjQUFBLFdBQUFBLGNBQUEsRUFBQUQsY0FBQSxHQWZaLEtBQU0sQ0FBQUUsRUFBRSxFQUFBRixjQUFBLEdBQUFHLENBQUEsTUFBR0MsT0FBTyxDQUFDLHFCQUFxQixDQUFDLEVBQ3pDLEtBQU0sQ0FBQUMsTUFBTSxFQUFBTCxjQUFBLEdBQUFHLENBQUEsTUFBR0MsT0FBTyxDQUFDLFVBQVUsQ0FBQyxFQUFDSixjQUFBLEdBQUFHLENBQUEsTUFFbkMsS0FBTSxDQUFBRyxRQUFRLENBQUcsS0FBQUEsQ0FBT0MsR0FBRyxDQUFFQyxHQUFHLEdBQUssQ0FBQVIsY0FBQSxHQUFBUyxD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